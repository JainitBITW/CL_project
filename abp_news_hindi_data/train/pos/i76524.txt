पेशावर का प्रशासक यार मोहम्मद महाराजा रणजीत सिंह को नजराना देना कबूल कर चुका था। मोहम्मद अजीम, जो कि काबुल का शासक था, ने पेशावर के यार मोहम्मद पर फिकरा कसा कि वह एक काफिर के आगे झुक गया है। अजीम काबुल से बाहर आ गया। उसने जेहाद का नारा बुलन्द किया, जिसकी प्रतिध्वनि खैबर में सुनाई दी। लगभग पैंतालिस हजार खट्टक और यूसुफजाई कबीले के लोग सैय्‌यद अकबर शाह के नेतृत्व में एकत्र किये गये। यार मोहम्मद ने पेशावर छोड़ दिया और कहीं छुप गये। महाराजा रणजीत सिंह ने सेना को उत्तर की ओर पेशावर कूच करने का आदेश दिया। राजकुमार शेर सिंह, दीवान चन्द और जनरल वेन्चूरा अपनी-अपनी टुकड़ियों का नेतृत्व कर रहे थे। हरि सिंह नलवा, अकाली बाबा फूला सिंह, फतेह सिंह आहलुवालिया, देसा सिंह मजीठिया और अत्तर सिंह सन्धावालिये ने सशस्त्र दलों और घुड़सवारों का नेतृत्व किया। तोपखाने की कमान मियां गोस खान और जनरल एलार्ड के पास थी।